<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>League Stats Dashboard & Fieberkurve</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
  h1, h2 { text-align: center; }
  textarea { width: 90%; max-width: 600px; height: 200px; display: block; margin: 0 auto 20px auto; font-size: 1rem; }
  button { display: block; margin: 0 auto 20px auto; padding: 10px 20px; font-size: 1rem; }
  table { width: 90%; max-width: 800px; margin: 0 auto 40px auto; border-collapse: collapse; background: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
  th, td { padding: 8px 12px; text-align: center; border-bottom: 1px solid #eee; }
  th { background: #e9eff5; }
  .chart-container { width: 95%; max-width: 1200px; margin: auto; height: 500px; }
</style>
</head>
<body>

<h1>League Stats Dashboard</h1>

<textarea id="rawData">
Markus   63, 25, 69
Erwin    48, 58, 63
Phil     76, 63, 20
Didi     48, 12, 32
Steffo   42, 85, 96
Basti    25, 52, 78
Eirik    99, 3,  45
Emil     61, 72, 91
Kempka   36, 25, 32
Espen    57, 29, 53
Alex     45, 50, 87
</textarea>

<button onclick="updateDashboard()">Update Dashboard & Chart</button>

<h2>Score Table</h2>
<table id="leagueTable">
  <thead>
    <tr id="tableHeader"><th>Spieler</th></tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<h2>Cumulative Points (Fieberkurve)</h2>
<div class="chart-container">
  <canvas id="fieberChart"></canvas>
</div>

<script>
let chart;

function updateDashboard() {
  const raw = document.getElementById('rawData').value.trim().split('\n');
  const players = [];
  const playerPoints = {};
  let maxMatchdays = 0;

  // Parse textarea into playerPoints
  raw.forEach(line => {
    const [name, ...scores] = line.split(/[\s,]+/);
    const points = scores.map(Number);
    players.push(name);
    playerPoints[name] = points;
    if (points.length > maxMatchdays) maxMatchdays = points.length;
  });

  // Build table header
  const tableHeader = document.getElementById('tableHeader');
  tableHeader.innerHTML = '<th>Spieler</th>';
  for (let i = 1; i <= maxMatchdays; i++) {
    tableHeader.innerHTML += `<th>Spieltag ${i}</th>`;
  }

  // Build table body
  const tableBody = document.getElementById('tableBody');
  tableBody.innerHTML = '';
  players.forEach(p => {
    let row = `<tr><td>${p}</td>`;
    playerPoints[p].forEach(pt => row += `<td>${pt}</td>`);
    row += '</tr>';
    tableBody.innerHTML += row;
  });

  // Calculate cumulative points
  const cumulativePoints = {};
  players.forEach(p => {
    let sum = 0;
    cumulativePoints[p] = playerPoints[p].map(pt => sum += pt);
  });

  // Prepare datasets
  const colors = [
    '#E41A1C','#377EB8','#4DAF4A','#984EA3','#FF7F00',
    '#A65628','#F781BF','#999999','#66C2A5','#FFD92F','#000000'
  ];

  const datasets = players.map((name, i) => ({
    label: name,
    data: cumulativePoints[name],
    borderColor: colors[i % colors.length],
    backgroundColor: colors[i % colors.length],
    fill: false,
    tension: 0.2
  }));

  // Destroy previous chart if exists
  if(chart) chart.destroy();

  // Draw chart
  const ctx = document.getElementById('fieberChart').getContext('2d');
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: Array.from({length: maxMatchdays}, (_, i) => i + 1),
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: { display: true, text: 'Fieberkurve (Kumulative Punkte)' }
      },
      scales: { y: { beginAtZero: true }, x: { title: { display: true, text: 'Spieltag' } } }
    }
  });
}

// Initialize dashboard on page load
updateDashboard();
</script>

</body>
</html>
