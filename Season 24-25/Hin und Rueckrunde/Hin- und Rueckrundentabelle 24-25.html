<!DOCTYPE html>
<html>
  <head>
    <title>Hin- und Rückrundentabelle 24-25</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Hin- und Rückrundentabelle 24-25</h1>
    <div id="tables"></div>

    <script>
      const pointsAfter17 = {
        Espen: 1170,
        Phil: 960,
        Emil: 954,
        Erwin: 898,
        Kempka: 880,
        Markus: 788,
        Steffen: 761,
        Eirik: 726,
        Basti: 725,
        Didi: 504
      };

      const pointsAfter34 = {
        Espen: 1989,
        Phil: 1699,
        Emil: 1806,
        Erwin: 1815,
        Kempka: 1672,
        Markus: 1673,
        Steffen: 1384,
        Eirik: 1517,
        Basti: 1438,
        Didi: 1167
      };

      function toArray(obj) {
        return Object.entries(obj).map(([name, points]) => ({ name, points }));
      }

      function calculateRueckrunde(after17, after34) {
        const rueckrundeData = [];
        for (const name in after17) {
          if (after34[name] !== undefined) {
            rueckrundeData.push({
              name,
              points: after34[name] - after17[name]
            });
          }
        }
        return rueckrundeData;
      }

      function renderTable(data, title, highlightTop = false, positionMap = null) {
        const sorted = [...data].sort((a, b) => b.points - a.points);
        const topScore = sorted.length > 0 ? sorted[0].points : null;

        let html = `
          <div style="margin-bottom: 2rem;">
            <h2 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">${title}</h2>
            <table style="width: 100%; border-collapse: collapse; text-align: left;">
              <thead>
                <tr style="border-bottom: 2px solid #ccc;">
                  <th style="padding: 0.5rem;">Place</th>
                  <th style="padding: 0.5rem;">Name</th>
                  <th style="padding: 0.5rem;">Points</th>
                  ${positionMap ? '<th style="padding: 0.5rem;">Change</th>' : ''}
                </tr>
              </thead>
              <tbody>
        `;

        sorted.forEach((entry, i) => {
          const highlight =
            highlightTop && entry.points === topScore
              ? ' style="background-color: #fff9c4; font-weight: bold;"'
              : "";
          const currentPlace = i + 1;
          const oldPlace = positionMap?.[entry.name];
          const change = oldPlace ? oldPlace - currentPlace : null;
          let changeText = "";
          if (change !== null) {
            if (change > 0) {
              changeText = `<span style="color: green;">↑${change}</span>`;
            } else if (change < 0) {
              changeText = `<span style="color: red;">↓${-change}</span>`;
            } else {
              changeText = "–";
            }
          }

          html += `
            <tr${highlight}>
              <td style="padding: 0.5rem;">${currentPlace}</td>
              <td style="padding: 0.5rem;">${entry.name}</td>
              <td style="padding: 0.5rem;">${entry.points}</td>
              ${positionMap ? `<td style="padding: 0.5rem;">${changeText}</td>` : ''}
            </tr>
          `;
        });

        html += `</tbody></table></div>`;
        return html;
      }

      document.addEventListener("DOMContentLoaded", () => {
        const hinrunde = toArray(pointsAfter17);
        const hinrundeSorted = [...hinrunde].sort((a, b) => b.points - a.points);
        const hinrundePositions = {};
        hinrundeSorted.forEach((entry, i) => {
          hinrundePositions[entry.name] = i + 1;
        });

        const rueckrunde = calculateRueckrunde(pointsAfter17, pointsAfter34);
        document.getElementById("tables").innerHTML =
          renderTable(hinrunde, "Hinrunde Tabelle") +
          renderTable(rueckrunde, "Rückrunde Tabelle", false, hinrundePositions);
      });
    </script>
  </body>
</html>
