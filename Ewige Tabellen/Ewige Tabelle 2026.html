<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      margin: 2rem;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .table-responsive {
      width: 100%;
      max-width: 1200px;
      overflow-x: auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 700px;
      background: white;
    }
    thead {
      background: linear-gradient(90deg, #004e92, #000428);
      color: white;
      font-weight: 700;
      font-size: 0.95rem;
      text-align: left;
      user-select: none;
      cursor: pointer;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    thead th {
      padding: 12px 16px;
      position: relative;
      background: inherit;
    }
    thead th.sort-asc::after {
      content: " ▲";
      position: absolute;
      right: 10px;
    }
    thead th.sort-desc::after {
      content: " ▼";
      position: absolute;
      right: 10px;
    }
    tbody tr {
      transition: background-color 0.25s ease;
      cursor: default;
    }
    tbody tr:nth-child(even) {
      background: #f9fafb;
    }
    tbody tr:hover {
      background: #e1eaff;
    }
    tbody td {
      padding: 12px 16px;
      font-size: 0.9rem;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
    }
    h2 {
      max-width: 1200px;
      width: 100%;
      margin: 0 0 1rem 0;
      font-weight: 700;
      font-size: 1.5rem;
      background: linear-gradient(90deg, #6a11cb, #2575fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    ul#highlight-list {
      max-width: 1200px;
      width: 100%;
      background: white;
      border-radius: 10px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      padding: 1rem 1.5rem;
      list-style: inside disc;
      color: #444;
      font-size: 0.95rem;
      line-height: 1.5;
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 2rem;
    }
    .chart-container {
      width: 90%;
      max-width: 1200px;
      height: 400px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 3rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .chart-container:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    }
    /* Mobile styles */
    @media (max-width: 800px) {
      body {
        margin: 0.5rem;
      }
      .table-responsive {
        border-radius: 0;
        box-shadow: none;
      }
      table {
        min-width: 600px;
        font-size: 0.86rem;
      }
      thead th, tbody td {
        padding: 8px 8px;
        font-size: 0.8rem;
      }
      h2 {
        font-size: 1.1rem;
      }
      .chart-container {
        padding: 2vw;
        height: 250px;
      }
      ul#highlight-list {
        padding: 0.5rem 0.7rem;
        font-size: 0.85rem;
      }
    }
    @media (max-width: 600px) {
      table {
        min-width: 480px;
        font-size: 0.8rem;
      }
      thead th, tbody td {
        padding: 6px 6px;
        font-size: 0.75rem;
      }
      .chart-container {
        height: 180px;
      }
      h2 {
        font-size: 0.98rem;
      }
    }
  </style>
</head>
<body>

  <div class="table-responsive">
    <table id="leaderboard" aria-label="Leaderboard table">
      <thead>
        <tr>
          <th data-key="platz">Platz</th>
          <th data-key="spieler">Spieler</th>
          <th data-key="spiele">Spiele</th>
          <th data-key="punkte">Punkte</th>
          <th data-key="pps">ø P.p.S</th>
          <th data-key="meister">Meister</th>
          <th data-key="letzter">Letzter</th>
          <th data-key="spieltagssiege">Spieltagssiege</th>
          <th data-key="spieltagsletzter">Spieltagsletzter</th>
          <th data-key="tabellenerster">Tabellenerster</th>
          <th data-key="tabellenletzter">Tabellenletzter</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <h2>Fiebertabelle</h2>
  <div class="chart-container">
    <canvas id="fieberkurveChart"></canvas>
  </div>

  <h2>Highlights</h2>
  <ul id="highlight-list"></ul>

  <script>
    const leaderboardData = [
      { platz: 1, spieler: 'Markus', spiele: 170, punkte: 9287, pps: 54.63, meister: 1, letzter: 0, spieltagssiege: 43, spieltagsletzter: 10, tabellenerster: 52, tabellenletzter: 3 },
      { platz: 2, spieler: 'Erwin', spiele: 170, punkte: 8812, pps: 51.83, meister: 1, letzter: 0, spieltagssiege: 24, spieltagsletzter: 11, tabellenerster: 34, tabellenletzter: 19 },
      { platz: 3, spieler: 'Phil', spiele: 170, punkte: 8432, pps: 49.60, meister: 1, letzter: 0, spieltagssiege: 32, spieltagsletzter: 31, tabellenerster: 38, tabellenletzter: 2 },
      { platz: 4, spieler: 'Eirik', spiele: 170, punkte: 7585, pps: 44.62, meister: 1, letzter: 1, spieltagssiege: 19, spieltagsletzter: 26, tabellenerster: 6, tabellenletzter: 32 },
      { platz: 5, spieler: 'Didi', spiele: 170, punkte: 7272, pps: 42.78, meister: 0, letzter: 3, spieltagssiege: 16, spieltagsletzter: 38, tabellenerster: 1, tabellenletzter: 79 },
      { platz: 6, spieler: 'Basti', spiele: 136, punkte: 6183, pps: 45.47, meister: 0, letzter: 0, spieltagssiege: 16, spieltagsletzter: 19, tabellenerster: 1, tabellenletzter: 2 },
      { platz: 7, spieler: 'Steffo', spiele: 136, punkte: 5573, pps: 40.97, meister: 0, letzter: 1, spieltagssiege: 4, spieltagsletzter: 31, tabellenerster: 0, tabellenletzter: 33 },
      { platz: 8, spieler: 'Emil', spiele: 68, punkte: 3887, pps: 57.16, meister: 0, letzter: 0, spieltagssiege: 8, spieltagsletzter: 1, tabellenerster: 3, tabellenletzter: 0 },
      { platz: 9, spieler: 'Espen', spiele: 34, punkte: 2042, pps: 60.06, meister: 1, letzter: 0, spieltagssiege: 12, spieltagsletzter: 1, tabellenerster: 34, tabellenletzter: 0 },
      { platz: 10, spieler: 'Kempka', spiele: 34, punkte: 1750, pps: 51.47, meister: 0, letzter: 0, spieltagssiege: 4, spieltagsletzter: 3, tabellenerster: 0, tabellenletzter: 0 },
      { platz: 11, spieler: 'Alex', spiele: 17, punkte: 0, pps: '-', meister: 0, letzter: 0, spieltagssiege: null, spieltagsletzter: null, tabellenerster: null, tabellenletzter: null }
    ];

    const highlights = [
      "=== Highlights der Saison 25-26 ===",
      "- Keine Spieltagssiege in der Saison ",
      "- Keine Spieltagsniederlagen von ",
      "- Höchste Spieltagpunkte von  ",
      "- Niedrigste Spieltagspunkte von ",
      "-  Spieltagssiege in Folge ",
      "-  Spieltagsniederlagen in Folge von ",
      "- Schlechtester Erster:",
      "- Bester Letzter:",
      "-  Spieltagssiege von ",
      "-  Spieltagsniederlagen von ",
      "",
      "",
      "",
      "",
      "=== Ewige Bestplatzierungen ===",
      "27. Markus mit 108 Punkten 22/23",
      "36. Phil mit 93 Punkten 22/23",
      "108. Phil mit 104 Punkten 24/25",
      "278. Phil mit 91 Punkten 22/23",
      "444. Markus mit 104 Punkten 20/21",
      "614. Phil mit 87 Punkten 22/23",
      "739. Eirik mit 93* Punkten 20/21",
      "766. Phil mit 96 Punkten 21/22",
      "984. Didi mit 91 Punkten 23/24",
      "989. Markus mit 94 Punkten 23/24",
      "",
      "",
      "",
      "",
      "=== Ewige Statistiken ===",
      "- Meiste Spieltagssiege in einer Saison vom Markus mit 13 (21/22)",
      "- Meiste Spieltagsniederlagen in einer Saison von Steffo mit 15 (21/22)",
      "- Ewig wenigste Punkte für Spieltagssieg von Erwin mit 31* Punkten (20/21)",
      "- Ewig wenigste Punkte von Phil mit -9 (22/23) (nur 20 Leute haben weniger punkte gemacht)",
      "- Ewig Höchstpunktzahl von Emil mit 113 (23/24) (leider nicht unter den Top 1000 an dem Spieltag)",
      "",
      "",
      "",
      "",
      "=== Meister ===",
      "- Meister 2021: Eirik mit 1847* Punkten (1609 Ø Punkte in der Liga)",
      "- Meister 2022: Phil mit 1826 Punkten (1481 Ø Punkte in der Liga)",
      "- Meister 2023: Erwin mit 1957 Punkten (1541 Ø Punkte in der Liga)",
      "- Meister 2024: Markus mit 2224 Punkten (1799 Ø Punkte in der Liga)",
      "- Meister 2025: Espen mit 2042 Punkten (1686 Ø Punkte in der Liga)",
      "",
      "",
      "",
      "=== Fussnoten ===",
      "-*in der Saison 20/21 gab es nur zwei Punkte für Startelf und einen für Einwechslung, habe alles nachgeschaut und an die fehlende Punkte addiert (ist ab 2024 in der Ewigen Tabelle miteinberechnet",
      "-Seit der Saison 24/25 gibt es 2 Punkte anstelle von einem für eine Vorlage. Ist mir Wurst, werde das nicht alles neu nachrechnen!"
    ];

    // Helper to check if value is numeric
    function isNumeric(value) {
      return !isNaN(parseFloat(value)) && isFinite(value);
    }

    // Render leaderboard rows
    function renderLeaderboard(data) {
      const tbody = document.querySelector("#leaderboard tbody");
      tbody.innerHTML = '';
      data.forEach(player => {
        const row = document.createElement("tr");
        for (const key of ['platz', 'spieler', 'spiele', 'punkte', 'meister', 'letzter', 'spieltagssiege', 'spieltagsletzter', 'tabellenerster', 'tabellenletzter']) {
          const cell = document.createElement("td");
          let val = player[key];
          if (val === null || val === undefined || val === '') {
            val = '-';
          }
          cell.textContent = val;
          row.appendChild(cell);
        }
        tbody.appendChild(row);
      });
    }

    // Sorting variables
    let currentSortKey = 'punkte';
    let currentSortAsc = false;

    function sortLeaderboard(data, key, asc) {
      return data.slice().sort((a, b) => {
        let valA = a[key];
        let valB = b[key];

        // Treat null/empty as lowest
        if (valA === '' || valA === null || valA === undefined) valA = asc ? -Infinity : Infinity;
        if (valB === '' || valB === null || valB === undefined) valB = asc ? -Infinity : Infinity;

        if (isNumeric(valA) && isNumeric(valB)) {
          return asc ? valA - valB : valB - valA;
        } else {
          // Text comparison
          valA = valA.toString();
          valB = valB.toString();
          return asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
        }
      });
    }

    function clearSortIndicators() {
      document.querySelectorAll("#leaderboard thead th").forEach(th => {
        th.classList.remove('sort-asc', 'sort-desc');
      });
    }

    function updateSortIndicator(th, asc) {
      th.classList.add(asc ? 'sort-asc' : 'sort-desc');
    }

    // Setup sorting event listeners on headers
    document.querySelectorAll("#leaderboard thead th").forEach(th => {
      th.addEventListener('click', () => {
        const key = th.dataset.key;
        if (!key) return;

        if (currentSortKey === key) {
          currentSortAsc = !currentSortAsc;
        } else {
          currentSortKey = key;
          currentSortAsc = false; // default descending
        }

        clearSortIndicators();
        updateSortIndicator(th, currentSortAsc);

        const sortedData = sortLeaderboard(leaderboardData, currentSortKey, currentSortAsc);
        renderLeaderboard(sortedData);
      });
    });

    // Initial render & indicator
    renderLeaderboard(sortLeaderboard(leaderboardData, currentSortKey, currentSortAsc));
    document.querySelector("#leaderboard thead th[data-key='punkte']").classList.add('sort-desc');

    // Populate highlights list
    const highlightList = document.getElementById("highlight-list");
    highlights.forEach(text => {
      const li = document.createElement("li");
      li.textContent = text;
      highlightList.appendChild(li);
    });

    // Fieberkurve data and chart setup
    const fiebertabelleData = {
      'Eirik': { s1: 1846, s2: 1107, s3: 1630, s4: 1421, s5: 1581 },
      'Markus': { s1: 1923, s2: 1733, s3: 1646, s4: 2224, s5: 1761 },
      'Phil': { s1: 1717, s2: 1826, s3: 1430, s4: 1671, s5: 1788 },
      'Erwin': { s1: 1536, s2: 1571, s3: 1957, s4: 1845, s5: 1903 },
      'Didi': { s1: 1391, s2: 1735, s3: 1267, s4: 1667, s5: 1212 },
      'Steffo': { s2: 957, s3: 1558, s4: 1620, s5: 1438 },
      'Basti': { s2: 1441, s3: 1303, s4: 1924, s5: 1512 },
      'Emil': { s4: 2014, s5: 1873 },
      'Kempka': { s5: 1750 },
      'Espen': { s5: 2042 }
    };

    const players = Object.keys(fiebertabelleData);
    const colors = [
      '#E41A1C', // Markus (red)
      '#377EB8', // Erwin (blue)
      '#4DAF4A', // Phil (green)
      '#984EA3', // Didi (purple)
      '#FF7F00', // Steffo (orange)
      '#A65628', // Basti (brown)
      '#F781BF', // Eirik (pink)
      '#999999', // Emil (gray)
      '#66C2A5', // Kempka (teal)
      '#FFD92F', // Espen (yellow)
      '#000000'  // Alex (black, unused here)
    ];

    const seasons = ['s1', 's2', 's3', 's4', 's5'];

    function cumulativePoints(seasonPoints) {
      const cumulative = [];
      let sum = 0;
      seasons.forEach(season => {
        if (seasonPoints[season] !== undefined) {
          sum += seasonPoints[season];
          cumulative.push(sum);
        } else {
          cumulative.push(null); // null to skip in chart
        }
      });
      return cumulative;
    }

    const datasets = players.map((spieler, i) => ({
      label: spieler,
      data: cumulativePoints(fiebertabelleData[spieler]),
      borderColor: colors[i],
      backgroundColor: colors[i],
      fill: false,
      pointRadius: 3,
      borderWidth: 2,
      spanGaps: true,
      hidden: false,
      opacity: 1
    }));

    const ctx = document.getElementById('fieberkurveChart').getContext('2d');
    const selectedIndices = new Set();

    const fieberChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: seasons.map(s => s.toUpperCase()),
        datasets: datasets
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              usePointStyle: true,
              pointStyle: 'circle',
              color: '#222'
            },
            onClick: (e, legendItem) => {
              const index = legendItem.datasetIndex;
              if (selectedIndices.has(index)) {
                selectedIndices.delete(index);
              } else {
                selectedIndices.add(index);
              }

              if (selectedIndices.size === 0) {
                // Reset all
                fieberChart.data.datasets.forEach((ds, i) => {
                  ds.borderColor = colors[i];
                  ds.backgroundColor = colors[i];
                  ds.borderWidth = 2;
                  ds.hidden = false;
                  ds.opacity = 1;
                });
              } else {
                fieberChart.data.datasets.forEach((ds, i) => {
                  if (selectedIndices.has(i)) {
                    ds.borderColor = colors[i];
                    ds.backgroundColor = colors[i];
                    ds.borderWidth = 4;
                    ds.hidden = false;
                    ds.opacity = 1;
                  } else {
                    ds.borderColor = '#ccc';
                    ds.backgroundColor = '#ccc';
                    ds.borderWidth = 1;
                    ds.hidden = false;
                    ds.opacity = 0.3;
                  }
                });
              }
              fieberChart.update();
            }
          },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y ?? '–'}`
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Cumulative Points'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Season'
            }
          }
        }
      },
      plugins: [{
        id: 'opacityPlugin',
        beforeDatasetsDraw(chart) {
          const ctx = chart.ctx;
          chart.data.datasets.forEach(ds => {
            ctx.save();
            ctx.globalAlpha = ds.opacity !== undefined ? ds.opacity : 1;
            ctx.restore();
          });
        }
      }]
    });
  </script>

</body>
</html>
